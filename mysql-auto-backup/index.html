
<!DOCTYPE html>
<html lang="fa" dir="rtl" translate="no" prefix="og: http://ogp.me/ns#" data-desktop>
<head>
 <meta charset="UTF-8"/>

 <title>آموزش صفر تا صد بکاپ خودکار از دیتابیس یک سرور لینوکس | جواد ادیب</title>
 <meta content="توی این آموزش هرچیزی که برای بکاپ گرفتن از دیتابیس یک سرور لینوکس لازمه رو توضیح میدم تا بتونید سریع و بدون دردسر از سرورتون بکاپ بگیرید" name="description"/>
 <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><![endif]-->
 <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5" name="viewport"/>
 <meta content="https://blog.mradib.com" name="site:root"/>
 <meta content="summary_large_image" name="twitter:card"/>
 <meta content="آموزش صفر تا صد بکاپ خودکار از دیتابیس یک سرور لینوکس | جواد ادیب" name="twitter:title"/>
 <meta content="توی این آموزش هرچیزی که برای بکاپ گرفتن از دیتابیس یک سرور لینوکس لازمه رو توضیح میدم تا بتونید سریع و بدون دردسر از سرورتون بکاپ بگیرید" name="twitter:description"/>
 <meta content="./files/202103/2-a5869fb1a09ea5452edfc50d9d8f3f3e.jpg?v=2" name="twitter:image"/>
 <meta content="@jibres_com" name="twitter:site"/>
 <meta content="@jibres_com" name="twitter:creator"/>
 <meta content="/mysql-auto-backup" name="twitter:url"/>
 <meta content="website" property="og:type"/>
 <meta content="آموزش صفر تا صد بکاپ خودکار از دیتابیس یک سرور لینوکس | جواد ادیب" property="og:title"/>
 <meta content="توی این آموزش هرچیزی که برای بکاپ گرفتن از دیتابیس یک سرور لینوکس لازمه رو توضیح میدم تا بتونید سریع و بدون دردسر از سرورتون بکاپ بگیرید" property="og:description"/>
 <meta content="./files/202103/2-a5869fb1a09ea5452edfc50d9d8f3f3e.jpg?v=2" property="og:image"/>
 <meta content="/mysql-auto-backup" property="og:url"/>
 <meta content="جواد ادیب" property="og:site_name"/>
 <meta content='fa' property='og:locale'/>

 <meta content="index, follow" name="robots"/>
 <meta content="yes" name="mobile-web-app-capable"/>
 <meta content="yes" name="apple-touch-fullscreen"/>
 <meta content="yes" name="apple-mobile-web-app-capable"/>
 <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
 <meta content="#000" name="theme-color"/>
 <meta content="#000" name="msapplication-TileColor">
 <meta content="جواد ادیب" name="application-name"/>
 <meta content="جواد ادیب" name="apple-mobile-web-app-title"/>
 <meta content="Jibres" name="generator"/>
 <meta content="business-website" name="jibres:zone"/>
 <link href="./files/202103/1-c8c1f17e2e03ae0ddada09e304a46e8f.jpg?v=1" type="image/png" rel="icon"/>
 <link href="./files/202103/1-c8c1f17e2e03ae0ddada09e304a46e8f.jpg?v=1" rel="shortcut icon"/>
 <link href="./files/202103/1-c8c1f17e2e03ae0ddada09e304a46e8f.jpg?v=1" rel="apple-touch-startup-image"/>
 <link href="./files/202103/1-c8c1f17e2e03ae0ddada09e304a46e8f.jpg?v=1" sizes="180x180" rel="apple-touch-icon"/>
 <link href="/manifest.webmanifest" rel="manifest"/>
 <meta content="/browserconfig.xml?v=1" name="msapplication-config"/>
 
 <link href="./static/css/siftal-v3.min.css?1677088095" rel="preload stylesheet" as="style"/>
</head>
<body data-subdomain='blog' data-env='jb2pj' data-in='business' data-page='mysql-auto-backup' data-preload>
 <header id='pageHeader' data-xhr='pageHeader' data-scroll><div class='desktop'><div id="jHeader3" class="relative py-5"><div class='m-auto max-w-screen-lg w-full px-2 sm:px-4 lg:px-5'><div class="actionBar flex items-center p-1 sm:p-2 md:p-3 bg-gray-50 rounded shadow-inner"><a href="https://blog.mradib.com" class="flex-1 flex items-center"><img class="inline-block w-16 h-16 rounded" src="./files/202103/1-c8c1f17e2e03ae0ddada09e304a46e8f.jpg" alt="جواد ادیب"><h1 class="inline-block px-2 text-2xl font-bold">جواد ادیب</h1></a></div><div class="menuBar flex items-center bg-gray-50 rounded shadow-inner mt-2"><nav class="flex-1"><ul class="flex"><li data-layer="1" data-key="2"><a data-item class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="/about">درباره</a></li><li data-layer="1" data-key="3"><a data-item class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="/contact">تماس</a></li></ul></nav><nav><ul class="flex"><li data-layer="1" data-key="5"><a data-item target="_blank" class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="https://instagram.com/MrJavadAdib">اینستاگرام</a></li><li data-layer="1" data-key="6"><a data-item target="_blank" class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="https://t.me/MrJavadAdib">تلگرام</a></li><li data-layer="1" data-key="7"><a data-item target="_blank" class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="https://github.com/MrJavadAdib/">گیت‌هاب</a></li><li data-layer="1" data-key="8"><a data-item target="_blank" class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="https://ir.linkedin.com/in/MrAdib/">لینکدین</a></li><li data-layer="1" data-key="9"><a data-item target="_blank" class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="https://www.facebook.com/MrJavadAdib">فیس‌بوک</a></li><li data-layer="1" data-key="10"><a data-item target="_blank" class="block p-1 sm:p-2 md:p-3 bg-gray-200 bg-opacity-0 hover:bg-opacity-70 transition" href="https://twitter.com/MrAdib">توییتر</a></li></ul></nav></div></div></div></div><div class='pwa'><a class='square minor back' href='https://blog.mradib.com'><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 16a.999.999 0 01-.707-1.707L11.586 10 7.293 5.707a.999.999 0 111.414-1.414l5 5a.999.999 0 010 1.414l-5 5A.997.997 0 018 16z" fill="#5C5F62"/></svg></a><div class='title'>آموزش صفر تا صد بکاپ خودکار از دیتابیس یک سرور لینوکس | جواد ادیب</div></div></header><div id="pageCenter" data-xhr="pageCenter">
 <aside id='sidebar' data-xhr='sidebar'></aside>
 <main id='pageContent' data-xhr='pageContent'><div class="postBlock" data-type="standard"><div class="avand-md zero"><article><header><img src="./files/202103/2-a5869fb1a09ea5452edfc50d9d8f3f3e-w1100.webp" alt="آموزش صفر تا صد بکاپ خودکار از دیتابیس یک سرور لینوکس"><h2>آموزش صفر تا صد بکاپ خودکار از دیتابیس یک سرور لینوکس</h2><p class="excerpt">توی این آموزش هرچیزی که برای بکاپ گرفتن از دیتابیس یک سرور لینوکس لازمه رو توضیح میدم تا بتونید سریع و بدون دردسر از سرورتون بکاپ بگیرید</p></header><div class="msg minimal infoBox"><div class="row align-center "><div class="c-xs-6 c-auto"><time class="ltr inline-block" datetime="2021-03-25 03:50:24" title="این نوشته در تاریخ پنجشنبه ۵ فروردین ۱۴۰۰ ۰۳:۵۰:۲۴ منتشر شده است">۱۴۰۰-۰۱-۰۵ ۰۳:۵۰</time></div><div class="c-xs-6 c-auto text-left"><abbr title="ما تخمین می‌زنیم که شما این نوشته را در ۷ دقیقه بخوانید.">در ۷ دقیقه بخوانید</abbr></div><div class="c-xs-2 c text-left">اشتراک‌گذاری</div><nav class="c-xs-10 c-auto share1 text-left"><a target="_blank" class="facebook" title="اشتراک‌گذاری در فیس‌بوک" href="https://www.facebook.com/sharer/sharer.php?u=/mysql-auto-backup">اشتراک‌گذاری در فیس‌بوک</a><a target="_blank" class="twitter" title="اشتراک‌گذاری در توییتر" href="https://twitter.com/home?status=/mysql-auto-backup">اشتراک‌گذاری در توییتر</a><a target="_blank" class="linkedin" title="اشتراک‌گذاری در لینکدین" href="https://www.linkedin.com/shareArticle?mini=true&url=/mysql-auto-backup&title=%D8%A2%D9%85%D9%88%D8%B2%D8%B4+%D8%B5%D9%81%D8%B1+%D8%AA%D8%A7+%D8%B5%D8%AF+%D8%A8%DA%A9%D8%A7%D9%BE+%D8%AE%D9%88%D8%AF%DA%A9%D8%A7%D8%B1+%D8%A7%D8%B2+%D8%AF%DB%8C%D8%AA%D8%A7%D8%A8%DB%8C%D8%B3+%DB%8C%DA%A9+%D8%B3%D8%B1%D9%88%D8%B1+%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3+%7C+%D8%AC%D9%88%D8%A7%D8%AF+%D8%A7%D8%AF%DB%8C%D8%A8&summary=%D8%AA%D9%88%DB%8C+%D8%A7%DB%8C%D9%86+%D8%A2%D9%85%D9%88%D8%B2%D8%B4+%D9%87%D8%B1%DA%86%DB%8C%D8%B2%DB%8C+%DA%A9%D9%87+%D8%A8%D8%B1%D8%A7%DB%8C+%D8%A8%DA%A9%D8%A7%D9%BE+%DA%AF%D8%B1%D9%81%D8%AA%D9%86+%D8%A7%D8%B2+%D8%AF%DB%8C%D8%AA%D8%A7%D8%A8%DB%8C%D8%B3+%DB%8C%DA%A9+%D8%B3%D8%B1%D9%88%D8%B1+%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3+%D9%84%D8%A7%D8%B2%D9%85%D9%87+%D8%B1%D9%88+%D8%AA%D9%88%D8%B6%DB%8C%D8%AD+%D9%85%DB%8C%D8%AF%D9%85+%D8%AA%D8%A7+%D8%A8%D8%AA%D9%88%D9%86%DB%8C%D8%AF+%D8%B3%D8%B1%DB%8C%D8%B9+%D9%88+%D8%A8%D8%AF%D9%88%D9%86+%D8%AF%D8%B1%D8%AF%D8%B3%D8%B1+%D8%A7%D8%B2+%D8%B3%D8%B1%D9%88%D8%B1%D8%AA%D9%88%D9%86+%D8%A8%DA%A9%D8%A7%D9%BE+%D8%A8%DA%AF%DB%8C%D8%B1%DB%8C%D8%AF">اشتراک‌گذاری در لینکدین</a><a target="_blank" class="telegram" title="اشتراک‌گذاری در تلگرام" href="https://t.me/share/url?url=/mysql-auto-backup&text=%D8%A2%D9%85%D9%88%D8%B2%D8%B4+%D8%B5%D9%81%D8%B1+%D8%AA%D8%A7+%D8%B5%D8%AF+%D8%A8%DA%A9%D8%A7%D9%BE+%D8%AE%D9%88%D8%AF%DA%A9%D8%A7%D8%B1+%D8%A7%D8%B2+%D8%AF%DB%8C%D8%AA%D8%A7%D8%A8%DB%8C%D8%B3+%DB%8C%DA%A9+%D8%B3%D8%B1%D9%88%D8%B1+%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3+%7C+%D8%AC%D9%88%D8%A7%D8%AF+%D8%A7%D8%AF%DB%8C%D8%A8">اشتراک‌گذاری در تلگرام</a><a class="copy" title="کپی لینک کوتاه" data-copy="/n/2" data-copy-msg="کد کوتاه این صفحه کپی شد. آن‌ را هر جا که خواستید قرار دهید!">کپی لینک کوتاه</a></nav></div></div><div class="text" data-text-style="t1"><p>سلام. من جواد ادیب هستم و این اولین نوشته من در وب‌سایت <a href="/hashtag/مسترادیب" data-hashtag-dir >#مسترادیب</a> به نشانی <a target="_blank" rel="noopener noreferrer" href="https://MrAdib.com/">MrAdib.com</a> هست. طی روزهای اخیر که مصادف با عید ۱۴۰۰ بود، مشکلاتی برای زیرساخت <a href="/hashtag/ابرآروان" data-hashtag-dir >#ابرآروان</a> پیش اومد و حمله هکرها منجر به صدمه دیدن سرورهای <a href="/hashtag/رایانش-ابری" data-hashtag-dir >#رایانش_ابری</a> آروان شد و حواشی بسیاری رو در پی داشت.</p><p>اما در این میان مهم‌ترین مساله‌ای که نظرم رو جلب کرد اینکه تعداد زیادی از کسب و کارها از سرورها و دیتابیس‌های خودشون هیچ نسخه پشتیبانی نداشتند و از دسترس خارج شدن سرورهاشون منجر به قطع سرویس اون‌ها شد. سرویس‌هایی که بعضی از اون‌ها مشتریان قابل توجهی داشتند و این موضوع رو عجیب‌تر می‌کرد. الان حدود یک هفته از این اتفاق می‌گذره و هنوز برخی نتونستن حتی سایت خودشون رو مجدد راه‌اندازی کنند و معلوم نیست این ماجرا تا کی ادامه خواهد داشت!</p><p>این خطر <a href="/hashtag/جیبرس" data-hashtag-dir >#جیبرس</a> رو هم تهدید کرد و شب قبل از بروز حادثه یه <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/MrAdib/status/1371639416792489985">قطعی حدود ۵ ساعتی</a> رو تجربه کردیم. بعد از گذشت حدود ۲ ساعت با وجود اینکه آروان گفت مشکل موقتی است و بزودی برطرف میشه، وقتی دیدم مشکل جدی به‌نظر میرسه یک سرور جدید ستاپ کردم و سایت جیبرس رو روی این سرور جدید دوباره راه‌اندازی کردم. لازم به ذکر هست که ما برای مدیریت کدها از <a href="/hashtag/گیت" data-hashtag-dir >#گیت</a> استفاده می‌کنیم و سایت جیبرس رو به‌گونه‌ای طراحی کردیم که صفحات اول در شرایط بحران مثل این مورد، بدون نیاز به اتصال به دیتابیس نمایش داده میشه و این حداقل از شدت فشار در ساعات اولیه حادثه کم میکنه.</p><p>بخاطر گستردگی سرویس جیبرس ما سرورهای متعددی برای کارهای مختلف داریم و به دلیل این پیچیدگی در زیرساخت، چند هفته پیش از بروز این حادثه، <a href="/hashtag/معماری" data-hashtag-dir >#معماری</a> جدید شبکه زیرساخت جیبرس رو طراحی کرده بودم ولی از اونجایی که پیاده‌سازی اون زمان زیادی می‌برد اجرای اون رو به بازه چند ماه آینده موکول کرده بودم. این اتفاق تلنگری به ما بود که ممکنه مساله ادامه داشته باشه و در این صورت خسارات بیشتری به ما وارد خواهد شد و این شروع استرس ما بود تا اینکه متاسفانه فردا شب اتفاقی که نباید رخ داد.</p><p>طی این مدت، روز و شبم شده بود انتقال و پیاده‌سازی معماری جدید زیرساخت جیبرس و خوشبختانه الان که در حال نوشتن این مقاله هستم کامل پیاده‌سازی شد و امیدوارم بتونم یه خواب راحت داشته باشم:)</p><p>با توجه به شرایط پیش اومده و خطری که جیبرس رو هم تهدید کرد، تصمیم گرفتن تغییراتی در سیستم <a href="/hashtag/بکاپ" data-hashtag-dir >#بکاپ</a> جیبرس بوجود بیارم و اون رو قوی‌تر کنم تا در بحران‌های این‌چنینی کمتر <a href="/hashtag/آسیب" data-hashtag-dir >#آسیب</a> ببینیم. در کنار اون جدا از تمام داستان‌های پیش اومده یک <a target="_blank" rel="noopener noreferrer" href="https://github.com/jibres/MySQL-auto-backup">راهنمای سریع بکاپ از دیتابیس</a> توی <a href="/hashtag/گیت-هاب" data-hashtag-dir >#گیت‌هاب</a> منتشر کردم تا به کسانی که در حال انتقال و راه‌اندازی مجدد هستن کمک کنم تا این‌بار از ابتدا به فکر نسخه پشتیبان باشند. این مقاله در تکمیل اون آموزش قبلی است و بزودی مقاله‌ای جدید برای بکاپ‌گرفتن از همه چیز در یک سرور لینوکس منتشر خواهم کرد. بکاپ خودکار از فایل‌ها، تنظیمات و <a href="/hashtag/دیتابیس" data-hashtag-dir >#دیتابیس</a> از یک سرور به چندین <a href="/hashtag/سرور" data-hashtag-dir >#سرور</a> پشتیبان.</p><p>هم‌چنین لازمه بدونید ما برای دیتابیس می‌تونیم دونوع بکاپ داشته باشید. ما درباره بکاپ در بازه زمانی مثلا ساعتی، روزانه و ماهیانه داریم صحبت می‌کنیم که ساده‌تر قابل پیاده‌سازی هست و وجودش برای هر سروری الزامی است. بکاپ زنده از دیتابیس یا <a href="/hashtag/ریپلیکیشن" data-hashtag-dir >#ریپلیکیشن</a> در دیتابیس نیاز خاص‌تری بوده و در آینده در مقاله‌ای مجزا در این‌باره توضیح خواهم داد.</p><h2>بکاپ خودکار از مای‌اس‌کیوال MySQL</h2><p>با طی کردن مراحل زیر می‌تونید یاد بگیرید که چطور از دیتابیس مای‌اس‌کیوال <a href="/hashtag/mysql" data-hashtag-dir >#MySQL</a> خودتون بکاپ بگیرید و اون رو به یک مکان امن خارج از سرور فعلی منتقل کنید. توصیه میشه نسخه بکاپ برای شرایط بحران حداقل ۲۰۰ کیلومتر از نسخه اصلی فاصله داشته باشه. پس بهتره اون رو در یک دیتاسنتر دیگه ترجیحا در یک شهر دیگه نگهدارید.</p><h3>ساخت یوزر دیتابیس با دسترسی فقط خواندن برای بکاپ‌گیری</h3><p>وارد سرور خودتون بشید و با یوزری که دارید وارد مای‌اس‌کیو ال بشید. ما فرض میگیریم که یوزر دیتابیس شما روت هست. مراحل زیر رو به ترتیب انجام بدید. توجه کنید که اگه روی سرور خودتون پی‌اچ‌پی‌مای‌ادمین <a href="/hashtag/phpmyadmin" data-hashtag-dir >#phpmyadmin</a> ریختید نیازی به این کارهای سخت(!) نیست و کافیه از طریق رابط کاربری یوزر رو بسازید.</p><h4>از طریق محیط دستوری MySQL و کامندلاین</h4><p>۱. دستور زیر رو بزنید تا یوزر روت وارد بشید. اگه یوزر دیگه‌ای دارید اون رو وارد کنید.</p><pre>sudo mysql -u root -p</pre><p>۲. دستور زیر یه یوزر به نام dumper با پسورد PUT_YOUR_PASSWORD_HERE میسازه. یوزر و پسورد رو به دلخواه خودتون تغییر بدید</p><pre>CREATE USER '<i><strong>dumper</strong></i>'@'localhost' IDENTIFIED WITH mysql_native_password BY '<i><strong>PUT_YOUR_PASSWORD_HERE</strong></i>';</pre><p>۳. دسترسی خواندن، پروسس و قفل کردن جداول رو به این یوزر بدید. توجه کنید اگه اسم یوزر رو توی دستور بالا تغییر دادید توی پایینی هم تغییر رو اعمال کنید.</p><pre>GRANT SELECT, PROCESS, LOCK TABLES ON *.* TO '<i><strong>dumper</strong></i>'@'localhost';</pre><p>۴. کد زیر رو بزنید تا سطوح دسترسی تنظیم شده اعمال بشه</p><pre>flush privileges;</pre><p>۵. از محیط اس‌کیو‌ال خارج بشید</p><pre>exit;</pre><h4>روش آسان از طریق phpmyadmin</h4><figure class="image"><img src="./files/202103/3-934d99aad386e71eb25e513513d2e22f.png"><figcaption>در هنگام ساخت کاربر جدید از طریق phpmyadmin تیک‌های مشخص شده در عکس بالا را بزنید تا کاربر فقط توانایی خواندن داشته باشد</figcaption></figure><h3>ذخیره‌کردن اطلاعات یوزر و پسورد برای بکاپ‌گیری خودکار</h3><p>حالا که یوزر جدید ساختین بهتره که اطلاعات اون رو ذخیره کنید تا نیازی نباشه که یوزر و پسورد رو توی کامند هربار پاس بدیم. دستور زیر رو بزنید تا فایل تنظیمات عمومی مای‌اس‌کیوال باز بشه</p><pre>sudo nano ~/.my.cnf</pre><p>حالا کافیه سه خط زیر رو توش کپی کنید. طبیعیه که یوزر و پسورد رو اگه (لطفا تغییرش بدید!) تغییر دادید اینجا هم باید مقدار جایگزین شده رو بزارید</p><pre>[mysqldump]</pre><pre>user=<i><strong>dumper </strong></i></pre><pre>password=<i><strong>PUT_YOUR_PASSWORD_HERE</strong></i></pre><p>برای ذخیره کردن و خروج از این فایل کافیه ctrl + x رو بزنید و در پاسخ به سوال آیا ذخیره کنم دکمه y رو فشار بدید.</p><h3>بکاپ گرفتن از دیتابیس</h3><p>حالا که یوزر مورد نظرمون رو ساختیم، با یه دستور یک خطی میتونیم از همه دیتابیس‌هایی که روی این سرور داریم بکاپ بگیریم. از اونجایی که رمز رو هم ذخیره کردیم هیچی نمی‌پرسه و توی آدرسی که بهش دادیم ساخت بکاپ رو شروع میکنه که بسته به حجم دیتابیس کمی طول میکشه</p><h4>بکاپ از یک دیتابیس خاص</h4><pre>mysqldump -v --column-statistics=0 --quick --single-transaction <i><strong>YOUR_DATABASE_NAME</strong></i> > /home/backup-$(date +%Y%m%d-%H%M%S).sql</pre><h4>بکاپ از همه دیتابیس‌ها</h4><pre>mysqldump -v --column-statistics=0 --quick --single-transaction --all-databases > backup-$(date +%Y%m%d-%H%M%S).sql</pre><h4>بکاپ از همه دیتابیس‌ها و فشرده‌سازی</h4><p>برای دیتابیس نمونه‌ای که روی این سیستم دارم بکاپ عادی از دیتابیس‌ها ۱.۷ گیگابایت فضا اشغال کرد. در حالی که فشرده‌سازی حجم اون رو ۷۰ مگابایت کاهش داد. برای بکاپ به‌دلیل جلوگیری از هدر رفتن بی‌دلیل فضا توصیه میشه که از مدل فشرده‌شده استفاده کنید.</p><pre>mysqldump -v --column-statistics=0 --quick --single-transaction --all-databases | gzip > backup-$(date +%Y%m%d-%H%M%S).sql.gz</pre><h2>ارسال فایل‌های بکاپ به یک سرور جدید</h2><p>بکاپ گرفته شده در این سرور امن نیست. چون با از دسترس خارج شدن این سرور ما بکاپ خودمون رو از دست خواهیم داد. پس بهتره اون رو به یک سرور دیگه یا محلی مناسب انتقال بدیم. برای این کار در لینوکس می‌تونید از دستور rsync‌ استفاده کنیم. اگه از اوبونتو استفاده می‌کنید که به‌صورت پیش‌فرض نصب هست ولی در برخی از توزیع‌های لینوکس لازمه که نصبش کنید که از طریق دستور زیر می‌تونید اون رو نصب کنید</p><pre>apt-get install rsync</pre><p>چون می‌خوایم تنظیم رو به‌گونه‌ای انجام بدیم که خودکار بکاپ ارسال بشه لازمه که اطلاعات دسترسی به سرور بکاپ(سرور مقصد یا B) رو توی سرور اصلی (سرور دیتابیس یا A) ذخیره کنیم. از اونجایی که استفاده از رمز ایمن نیست، پس یه کلید SSH میخوایم بسازیم. پس توی سرور اصلی دستور زیر رو بزنید. دو سه تا سوال می‌پرسه که میتونید با فشردن اینتر از اون‌ها بگذرید.</p><pre>ssh-keygen</pre><p>حالا وقتشه که یکبار رمز رو وارد کنیم تا ذخیره بشه. پس دستور زیر رو بزنید تا به سرور A اجازه بدیم به سرور B دسترسی داشته باشه. لازم به ذکر هست که خوبه یه یوزر ساده و بدون دسترسی خاص توی سرور B بسازید و از اون استفاده کنید. ما اینجا برای ساده‌تر شدن آموزش از یوزر روت استفاده کردیم. هم‌چنین آی‌پی 1.2.3.4 رو با آی‌پی سرور خودتون جایگزین کنید.</p><pre>ssh-copy-id <i><strong>root</strong></i>@<i><strong>1.2.3.4</strong></i></pre><p>بعد از وارد کردن دستور بالا، اگه اولین باره باید yes رو بزنید و بعدش ازتون رمز این یوزر توی سرور B رو میخواد که وارد کنید. حالا سرور A بدون رمز میتونه به سرور B وصل بشه.</p><h4>نمونه استفاده از دستور rsync</h4><p>دستور زیر از پورت ssh 22 برای انتقال آدرس اول یا مبدا به آدرس دوم یا مقصد استفاده میکنه. فلگ‌های استفاده شده که بعد از دستور لیست شدن به‌ترتیب a مربوط به حالت آرشیو، v مربوط به نمایش جزئیات روند انتقال، r مربوط به انتقال زیرپوشه‌ها، t مربوط به حفظ کردن تاریخ ویرایش فایل‌هاست.</p><pre>rsync -avrt --delete --rsh='ssh -p 22' /home/backup-file.sql /target_server/path/</pre><p>طبق پیشنهاد آقای <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/rafiee1001">احمد رفیعی</a>، بهتره که دستور rsync رو توی<strong> سرور مقصد</strong> اجرا کنید که بسته به مدل پیاده‌سازی شما و اگه سرور اصلی دسترسی مستقیم به اینترنت رو داره میشه از این مدل استفاده کرد. البته توجه داشته باشید که اگر نفوذ به سرور شما رخ بده و هکر دسترسی پیدا کنه، در هر دو صورت امکان خرابکاری در بکاپ وجود داره و این روش برای چنین حالتی بهینه نشده است. در این حالت باید جای آدرس‌ها رو باهم تغییر بدید شبیه به نمونه کد زیر خواهید داشت. هم‌چنین لازمه این دستور rsync رو در سرور بکاپ در یک کرون‌جاب قرار بدید تا به‌صورت منظم نسبت به تهیه بکاپ اقدام کنه</p><pre>rsync -avrt --delete /primary_server/home/backup-file.sql /home/backup/</pre><h2>ایجاد یک فایل برای انجام بکاپ و انتقال با هم</h2><p>برای اینکه روند بکاپ گرفتن خودکار بشه لازمه که فایلی برای انجام این دستوران با هم بسازیم پس دستور زیر رو وارد می‌کنیم تا  ادیتور باز بشه</p><pre>sudo nano /home/mysql-auto-backup/backup.sh</pre><p>حالا هر خط از کدهای زیر رو کپی کرده و توی این فایل قرار میدیم. خطا اول اسم فایل رو تنظیم میکنه که برای اینکه فایل‌ها تکراری نباشه تاریخ و ساعت رو به اسم فایل اضافه کردم</p><pre>FILENAME=backup-$(date +%Y%m%d-%H%M%S).sql.gz</pre><p>خط زیر از همه دیتابیس‌ها بکاپ میگیره و اون رو فشرده کرده و توی فایلی که بالا اسمش رو ساختیم قرار میده</p><pre>mysqldump --column-statistics=0 --quick --single-transaction --all-databases | gzip > /home/mysql-auto-backup/$FILENAME </pre><p>خط زیر هم فایل ساخته شده رو به آدرس سرور مدنظرمون منتقل می‌کنه</p><pre>rsync -avrt --delete /home/mysql-auto-backup/$FILENAME <i><strong>root</strong></i>@<i><strong>1.2.3.4</strong></i>:/home/mysql-auto-backup/</pre><p>برای ذخیره کردن و خروج از این فایل کافیه ctrl + x رو بزنید و در پاسخ به سوال آیا ذخیره کنم دکمه y رو فشار بدید. الان با هر بار فراخوانی این فایل تمام چیزهایی که برای بکاپ از دیتابیس لازم داریم با هم اجرا میشن</p><h2>تنظیم کرون‌جاب برای اجرای بکاپ در بازه زمانی</h2><p>به مرحله آخر رسیدیم. فایل ما آماده شده و تنها کافیه که اون رو به کرون‌جاب معرفی کنیم تا در بازه زمانی‌ای که خودمون تنظیم کردیم اجرا بشه. دستور زیر رو بزنید تا فایل کرون‌جاب باز بشه</p><pre>nano /etc/crontab</pre><p>حالا کافیه خط زیر رو کپی کرده و توی این فایل قرار بدید. این خط به‌معنی اجرای اسکریپت ما در هر یک ساعت هست. اگر بازه زمانی دیگری مدنظر شماست می‌تونید با مراجعه <a target="_blank" rel="noopener noreferrer" href="https://crontab.guru/">به این سایت</a> اون رو بسازید و جایگزین کنید</p><pre>0 * * * * root sh /home/mysql-auto-backup/backup.sh >/dev/null 2>&1</pre><p>برای ذخیره کردن و خروج از این فایل کافیه ctrl + x رو بزنید و در پاسخ به سوال آیا ذخیره کنم دکمه y رو فشار بدید.</p><p>تلاش کردم که آموزش بالا ساده باشه تا کمک کوچکی به شما برای بکاپ‌گیری خودکار و جلوگیری از صدمه دیدن کسب و کارتون کرده باشم. ولی از اونجایی که احساس کردم همین هم شاید سخت باشه این رو ارتقا دادم و یه اسکریپت آماده ساختم تا بتونید راحت‌تر از این‌ها بکاپ بگیرید. بزودی آموزش استفاده از اون اسکرپیت خودکار bash رو هم می‌نویسم و اینجا هم معرفی خواهم کرد.</p><div class="tagLine"><a class="btn-light mRa5 mB5" href="/hashtag/مسترادیب">مسترادیب</a> <a class="btn-light mRa5 mB5" href="/hashtag/ابرآروان">ابرآروان</a> <a class="btn-light mRa5 mB5" href="/hashtag/رایانش-ابری">رایانش_ابری</a> <a class="btn-light mRa5 mB5" href="/hashtag/جیبرس">جیبرس</a> <a class="btn-light mRa5 mB5" href="/hashtag/گیت">گیت</a> <a class="btn-light mRa5 mB5" href="/hashtag/معماری">معماری</a> <a class="btn-light mRa5 mB5" href="/hashtag/بکاپ">بکاپ</a> <a class="btn-light mRa5 mB5" href="/hashtag/آسیب">آسیب</a> <a class="btn-light mRa5 mB5" href="/hashtag/دیتابیس">دیتابیس</a> <a class="btn-light mRa5 mB5" href="/hashtag/سرور">سرور</a> <a class="btn-light mRa5 mB5" href="/hashtag/ریپلیکیشن">ریپلیکیشن</a> <a class="btn-light mRa5 mB5" href="/hashtag/mysql">MySQL</a> <a class="btn-light mRa5 mB5" href="/hashtag/phpmyadmin">phpmyadmin</a> <a class="btn-light mRa5 mB5" href="/hashtag/جواد-ادیب">جواد ادیب</a> <a class="btn-light mRa5 mB5" href="/hashtag/گیت-هاب">گیت‌هاب</a> <a class="btn-light mRa5 mB5" href="/hashtag/بحران">بحران</a> <a class="btn-light mRa5 mB5" href="/hashtag/مدیریت-بحران">مدیریت بحران</a> <a class="btn-light mRa5 mB5" href="/hashtag/صفرتاصد">صفرتاصد</a> </div></div></article><section class="box similarPost"><header><h4>توصیه شده برای شما</h4></header><nav class="body"><a class="block" href="/excel">دانلود رایگان کامل‌ترین آموزش اکسل</a></nav></section> <section class="box addCommentBox">
  <header>
    <h3>دیدگاه خود را بنویسید</h3>
  </header>
  <div class="body">
    <form method="post" data-refresh autocomplete="off" action="/comment">
              <input type="hidden" name="post_id" class="hide" value="2">
      
              <div class="row">
            <div class="c c-xs-12 mb-2">

              <div class="input">
               <label class="addon" for="name">نام</label>
               <input type="text" name="name" id="name" placeholder='نام کامل' maxlength='40' value="">
              </div>

            </div>
            <div class="c c-xs-12 mb-2">
              <div class="input">
               <label class="addon" for="mobile">موبایل</label>
               <input type="tel" name="mobile" id="mobile" placeholder='موبایل' maxlength="13" autocomplete="off" data-validity='لطفا شماره موبایل معتبری وارد کنید. :val اشتباه است' value="">
              </div>
            </div>

            <input type="text" name="username" class="hide" value="">
          </div>
          <div class="input mb-2">
       <input type="text" name="title" id="title" placeholder='عنوان' maxlength='40' >
      </div>
      <div class="mb-2">
        <textarea name="content" class="txt" rows="4" placeholder='نظر خودتون رو در مورد این نوشته بنویسید ...'></textarea>
      </div>

      <div class="row align-center">
        <div class="c">
          <div class="starRating">
            <fieldset>
              <input type="radio" name="rating" id="star5" value="5"/>
              <label for="star5" title="ممتاز">5 stars</label>
              <input type="radio" name="rating" id="star4" value="4"/>
              <label for="star4" title="خیلی خوب">4 stars</label>
              <input type="radio" name="rating" id="star3" value="3"/>
              <label for="star3" title="خوب">3 stars</label>
              <input type="radio" name="rating" id="star2" value="2"/>
              <label for="star2" title="ضعیف">2 stars</label>
              <input type="radio" name="rating" id="star1" value="1"/>
              <label for="star1" title="خیلی ضعیف">1 star</label>
            </fieldset>
          </div>
        </div>
        <div class="c-auto os">
          <button class="btn-primary">ارسال</button>
        </div>

      </div>
    </form>
  </div>
 </section> <section class="box reviewComments">
  <header>
    <h2>نظرات کاربران</h2>
  </header>
  <div class="body">
    <div class="row allReviewSummary">
      <div class="c-auto c-xs-0">
        <div class="ratingAvg">۵</div>
        <div class="ratingSummary">
          <div class="starRating inline-block" data-star='5' data-gold>
            <i></i><i></i><i></i><i></i><i></i>
          </div>
          <span>۲</span>
        </div>
      </div>
      <div class="c c-xs-12 rating">
        <div class="row">
          <div class="c-auto"><span class="sf-star">۵</span></div>
          <div class="c"><progress value="100" max="100"></progress></div>
          <div class="c-auto"><span class="percentVal">۱۰۰ ٪</span></div>
        </div>
        <div class="row">
          <div class="c-auto"><span class="sf-star">۴</span></div>
          <div class="c"><progress value="0" max="100"></progress></div>
          <div class="c-auto"><span class="percentVal">۰ ٪</span></div>
        </div>
        <div class="row">
          <div class="c-auto"><span class="sf-star">۳</span></div>
          <div class="c"><progress value="0" max="100"></progress></div>
          <div class="c-auto"><span class="percentVal">۰ ٪</span></div>
        </div>
        <div class="row">
          <div class="c-auto"><span class="sf-star">۲</span></div>
          <div class="c"><progress value="0" max="100"></progress></div>
          <div class="c-auto"><span class="percentVal">۰ ٪</span></div>
        </div>
        <div class="row">
          <div class="c-auto"><span class="sf-star">۱</span></div>
          <div class="c"><progress value="0" max="100"></progress></div>
          <div class="c-auto"><span class="percentVal">۰ ٪</span></div>
        </div>
      </div>
    </div>


    <div class="commnetList">
     <div class="alert2">
      <div class="row align-center">
        <div class="c-auto c-xs-12">
          <img class="customerImg w-10" src="./static/img/avatar/default.png" alt='بدون نام'>
        </div>
        <div class="c c-xs-12">
          <div class="msg minimal row align-center">
            <div class="c-auto c-xs-12">
              <div class="starRating" data-star='5'>
                <i></i><i></i><i></i><i></i><i></i>
              </div>
            </div>
            <div class="c">بدون نام</div>
            <div class="c-auto ltr txtRa">۱۴۰۰-۰۱-۰۹ ۰۶:۰۴</div>
          </div>
          <p>عالی بود. دنبال همچین چیزی بودم. حوصله نوشتن و پیاده سازیش رو نداشتم.</p>

        </div>
      </div>
            </div>
     <div class="alert2">
      <div class="row align-center">
        <div class="c-auto c-xs-12">
          <img class="customerImg w-10" src="./static/img/avatar/default.png" alt='بدون نام'>
        </div>
        <div class="c c-xs-12">
          <div class="msg minimal row align-center">
            <div class="c-auto c-xs-12">
              <div class="starRating" data-star='5'>
                <i></i><i></i><i></i><i></i><i></i>
              </div>
            </div>
            <div class="c">بدون نام</div>
            <div class="c-auto ltr txtRa">۱۴۰۰-۰۱-۰۵ ۱۷:۲۸</div>
          </div>
          <p>ممنون</p>

        </div>
      </div>
            </div>
    </div>
  </div>
</section>
</div></div>
 </main></div>
 <footer id='pageFooter' data-xhr='pageFooter'><div class='desktop'><div class="text-gray-600 body-font text-center shadow-inner"><div class="container px-5 py-5 mx-auto text-center"><a href="https://blog.mradib.com" class="title-font font-medium items-center md:justify-start justify-center text-gray-900 block"><span class="ml-3 text-xl">جواد ادیب</span></a><a href="https://blog.mradib.com" class="title-font font-medium items-center md:justify-start justify-center text-gray-900 block"><span class="ml-3 text-xl">برخی از حقوق محفوظ است.</span></a></div></div></div><div class='pwa'><nav class='flex'><div class='flex-1' data-key='home'><a href='https://blog.mradib.com' class='selected'><div class='icon'><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M18 7.261V17.5c0 .841-.672 1.5-1.5 1.5h-2c-.828 0-1.5-.659-1.5-1.5V13H7v4.477C7 18.318 6.328 19 5.5 19h-2c-.828 0-1.5-.682-1.5-1.523V7.261a1.5 1.5 0 01.615-1.21l6.59-4.82a1.481 1.481 0 011.59 0l6.59 4.82A1.5 1.5 0 0118 7.26z" fill="#5C5F62"/></svg></div><div class='title'>صفحه نخست</div></a></div><div class='flex-1' data-key='profile'><a href='/profile'><div class='icon'><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 0c5.514 0 10 4.486 10 10s-4.486 10-10 10S0 15.514 0 10 4.486 0 10 0zm6.24 15a7.99 7.99 0 01-12.48 0 7.99 7.99 0 0112.48 0zM10 10a3 3 0 100-6 3 3 0 000 6z" fill="#5C5F62"/></svg>
</div><div class='title'>پروفایل</div></a></div></nav></div></footer><div class="js">
  <script async src="./static/js/jibres.min.js?1677088097"></script>
 </div>
</body>
</html>